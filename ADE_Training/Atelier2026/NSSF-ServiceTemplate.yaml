tosca_definitions_version: tosca_simple_yaml_1_3
description: "VNFD service template"
imports:
  - etsi_nfv_sol001_vnfd_types.yaml
  - 5GC-NodeTypes.yaml
  
dsl_definitions:
  types:
    SpecificNodeTypeName: &SpecificName MyCompany.NSSF.1_0.1_0         
    
topology_template:

  substitution_mappings:
    node_type: *SpecificName
    requirements:
      virtual_link_5GCC:  [ 5gcc_cp, virtual_link ]
      virtual_link_MGT: [ mgt_cp, virtual_link ]


  node_templates:

    nf:
      type: *SpecificName
      properties:
        flavour_id: simple
      interfaces:
        Vnflcm:
          operations:
            scale: {}    
            scale_to_level: {}
            heal : {}  
    
    nf_main_vnfc:
      type: tosca.nodes.nfv.Vdu.Compute
      properties:
        name: Main VNFC
        description: This VNFC contains an the main NF software
        vdu_profile:
          min_number_of_instances: 1 
          max_number_of_instances: 10
      capabilities:
        virtual_compute:
          properties:
            virtual_memory:
              virtual_mem_size: 4 GB
            virtual_cpu:              
              num_virtual_cpu: 8
      requirements:
        - virtual_storage: nf_main_db
      artifacts:
        sw_image:
          type: tosca.artifacts.nfv.SwImage
          file: nf_main_vnfc.image.v1.0.qcow2
          properties:
            name: Main NF Software
            version: '1.0'
            checksum:
              algorithm: sha-256
              hash: c7c3036539fd7a5f87a1bf44eb12fdde8b556a1a7e664dbeda90ed3cd74b4f9d
            container_format: bare
            disk_format: qcow2
            min_disk: 2 GB
            size: 2 GB 

    nf_main_db: 
      type: tosca.nodes.nfv.Vdu.VirtualBlockStorage
      properties:
        virtual_block_storage_data:
          size_of_storage: 10 GB
          rdma_enabled: true

    nf_oam_vnfc:
      type: tosca.nodes.nfv.Vdu.Compute
      properties:
        name: OAM VNFC
        description: This VNFC contains an the OAM software
        vdu_profile:
          min_number_of_instances: 2 
          max_number_of_instances: 4
      capabilities:
        virtual_compute:
          properties:
            virtual_memory:
              virtual_mem_size: 2 GB
            virtual_cpu:              
              num_virtual_cpu: 2
      requirements:
        - virtual_storage: nf_oam_db
      artifacts:
        sw_image:
          type: tosca.artifacts.nfv.SwImage
          file: nf_oam.image.v1.0.qcow2
          properties:
            name: OAM NF Software
            version: '1.0'
            checksum:
              algorithm: sha-256
              hash: c7c3036539fd7a5f87a1bf44eb12fdde8b556a1a7e664dbeda90ed3cd74b4f9d
            container_format: bare
            disk_format: qcow2
            min_disk: 2 GB
            size: 2 GB 

    nf_oam_db: 
      type: tosca.nodes.nfv.Vdu.VirtualBlockStorage
      properties:
        virtual_block_storage_data:
          size_of_storage: 500 GB
          rdma_enabled: true

    5gcc_cp:
      type: tosca.nodes.nfv.VduCp
      properties:
        layer_protocols: [ ipv4 ]
        description: Connection point to the 5GC control plane
      requirements:
        - virtual_binding: nf_main_vnfc
  #     - virtual_link: # to be connected to an external virtual link
 
    mgt_cp:
      type: tosca.nodes.nfv.VduCp
      properties:
        layer_protocols: [ ipv4 ]
        description: Management connection point to the OSS
      requirements:
        - virtual_binding: nf_oam_vnfc
  #     - virtual_link: # to be connected to an external virtual link


## Instantiation levels and scaling policies  

  policies:
    - instantiation_levels:
        type: tosca.policies.nfv.InstantiationLevels
        properties:
          levels:
            small_instantiation_level:
              description: small
            medium_instantiation_level:
              description: medium         
            large_instantiation_level:
              description: large   
          default_level: small_instantiation_level

    - nf_main_vnfc_instantiation_levels:
        type: tosca.policies.nfv.VduInstantiationLevels
        properties:
          levels:
            small_instantiation_level:
              number_of_instances: 2
            medium_instantiation_level:
              number_of_instances: 4
            large_instantiation_level:
              number_of_instances: 8
        targets: [ nf_main_vnfc ]

    - nf_oam_vnfc_instantiation_levels:
        type: tosca.policies.nfv.VduInstantiationLevels
        properties:
          levels:
            small_instantiation_level:
              number_of_instances: 1
            medium_instantiation_level:
              number_of_instances: 2
            large_instantiation_level:
              number_of_instances: 3
        targets: [ nf_oam_vnfc ]


    - scaling_aspects:
        type: tosca.policies.nfv.ScalingAspects
        properties:
          aspects:
            all_vnfcs:
              name: This aspects represents all VNFCs
              description: there is only one scaling aspect
              max_scale_level: 2
            #other aspects will be inserted here
    - main_vnfc_initial_delta:
        type: tosca.policies.nfv.VduInitialDelta
        properties:
          initial_delta:
            number_of_instances: 1
        targets: [ nf_main_vnfc ]

    - main_vnfc_scaling_aspect_deltas:
        type: tosca.policies.nfv.VduScalingAspectDeltas
        properties:
          aspect: all_vnfcs
          deltas:
            delta_1:
              number_of_instances: 2
        targets: [ nf_main_vnfc ]


    - oam_vnfc_initial_delta:
        type: tosca.policies.nfv.VduInitialDelta
        properties:
          initial_delta:
            number_of_instances: 1
        targets: [ nf_oam_vnfc ]

    - oam_vnfc_scaling_aspect_deltas:
        type: tosca.policies.nfv.VduScalingAspectDeltas
        properties:
          aspect: all_vnfcs
          deltas:
            delta_1:
              number_of_instances: 1
        targets: [ nf_oam_vnfc ]

